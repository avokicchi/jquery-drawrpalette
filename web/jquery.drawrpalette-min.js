!function(e){e.fn.drawrpalette=function(t,r){var a=this;return a.offset=5,a.pickerSize=200,a.get_mouse_value=function(e,t){var r={};return"touchmove"==e.type||"touchstart"==e.type?(r.x=e.originalEvent.touches[0].pageX-t.offset().left-a.offset,r.y=e.originalEvent.touches[0].pageY-t.offset().top-a.offset):(r.x=e.pageX-t.offset().left-a.offset,r.y=e.pageY-t.offset().top-a.offset),r},a.rgb_to_hex=function(e,t,r){return"#"+(16777216+(r|t<<8|e<<16)).toString(16).slice(1)},a.hex_to_rgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},a.hsv_to_rgb=function(e,t,r){var a,o,s,l,i,n,d,p;switch(1===arguments.length&&(t=e.s,r=e.v,e=e.h),n=r*(1-t),d=r*(1-(i=6*e-(l=Math.floor(6*e)))*t),p=r*(1-(1-i)*t),l%6){case 0:a=r,o=p,s=n;break;case 1:a=d,o=r,s=n;break;case 2:a=n,o=r,s=p;break;case 3:a=n,o=d,s=r;break;case 4:a=p,o=n,s=r;break;case 5:a=r,o=n,s=d}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*s)}},a.rgb_to_hsv=function(e,t,r){1===arguments.length&&(t=e.g,r=e.b,e=e.r);var a,o=Math.max(e,t,r),s=Math.min(e,t,r),l=o-s,i=0===o?0:l/o,n=o/255;switch(o){case s:a=0;break;case e:a=t-r+l*(t<r?6:0),a/=6*l;break;case t:a=r-e+2*l,a/=6*l;break;case r:a=e-t+4*l,a/=6*l}return{h:a,s:i,v:n}},a.hsv_to_xy=function(e,t,r){return{x:t*a.pickerSize+a.offset,y:(1-r)*a.pickerSize+a.offset}},a.xy_to_hsv=function(e,t){return{s:e/a.pickerSize,v:(a.pickerSize-t)/a.pickerSize}},a.draw_hsv=function(e,t){var r=this.hsv,o=t.getContext("2d");for(o.clearRect(0,0,t.width,t.height),row=0;row<e;row++){var s=o.createLinearGradient(0,0,e,0),l=(e-row)/e,i=a.hsv_to_rgb(r.h,0,l);s.addColorStop(0,"rgb("+i.r+", "+i.g+","+i.b+")");i=a.hsv_to_rgb(r.h,1,l);s.addColorStop(1,"rgb("+i.r+", "+i.g+","+i.b+")"),o.fillStyle=s,o.fillRect(a.offset,row+a.offset,e,1)}for(row=0;row<e;row++)o.fillStyle="hsl("+360/e*row+", 100%, 50%)",o.fillRect(e+a.offset+5,row+a.offset,40,1);o.fillStyle="black",o.fillRect(e+a.offset+3,a.offset+r.h*e-3,44,6),o.fillStyle="white",o.fillRect(e+a.offset+5,a.offset+r.h*e-1,40,2);var n=a.hsv_to_xy(this.hsv.h,this.hsv.s,this.hsv.v);o.beginPath(),o.lineWidth=3,o.strokeStyle="black",o.arc(n.x,n.y,5,0,2*Math.PI),o.stroke(),o.beginPath(),o.lineWidth=2,o.strokeStyle="white",o.arc(n.x,n.y,4,0,2*Math.PI),o.stroke()},a.update_color=function(){var e=this.hsv,t=a.hsv_to_rgb(e.h,e.s,e.v),r="rgb("+t.r+","+t.g+","+t.b+")";this.$button.css("background-color",r),a.draw_hsv.call(this,a.pickerSize,this.$dropdown.find("canvas")[0])},a.update_value=function(){var t=a.hsv_to_rgb(this.hsv.h,this.hsv.s,this.hsv.v),r=a.rgb_to_hex(t.r,t.g,t.b);e(this).val(r)},a.cancel=function(){var t=a.hex_to_rgb(e(this).val()),r=a.rgb_to_hsv(t.r,t.g,t.b);this.hsv=r,a.update_color.call(this),e(this).trigger("cancel.drawrpalette",e(this).val())},this.each(function(){var r=this;if("destroy"===t){if(!e(r).hasClass("active-drawrpalette"))return!1;r.$button.off("mousedown.drawrpalette touchstart.drawrpalette"),r.$dropdown.find(".ok").off("mouseup.drawrpalette touchend.drawrpalette"),r.$dropdown.find(".cancel").off("mouseup.drawrpalette touchend.drawrpalette"),r.$dropdown.off("mousedown.drawrpalette touchstart.drawrpalette"),r.$button.off("mousedown.drawrpalette touchstart.drawrpalette"),e(window).off("mousedown.drawrpalette touchstart.drawrpalette"),e(window).off("mousemove.drawrpalette touchmove.drawrpalette"),e(window).off("mouseup.drawrpalette touchend.drawrpalette"),e(r).show(),r.$button.remove(),r.$dropdown.remove(),e(r).unwrap(),delete r.$wrapper,delete r.$button,delete r.$dropdown,delete r.hsl,delete r.slidingHue,delete r.slidingHsl,e(r).removeClass("active-drawrpalette")}else if("object"==typeof t||void 0===t){for(var o={},s=0,l=r.style.length;s<l;s++){var i=r.style[s],n=getComputedStyle(r,null).getPropertyValue(i);o[i]=n}var d=""!==r.className?r.className.split(" "):[];if(e(r).hasClass("active-drawrpalette"))return!1;r.className=r.className+" active-drawrpalette";var p={enable_alpha:!1,append_to:r};"object"==typeof t&&(p=Object.assign(p,t)),r.settings=p,r.plugin=a,e(this).wrap("<div class='drawrpallete-wrapper'></div>"),this.$wrapper=e(this).parent(),this.$wrapper.css({position:"relative",display:"inline-block"}),e(this).hide(),r.$button=e("<button>&nbsp;</button>"),r.$button.css({width:"40px",height:"40px",border:"2px solid #ccc","background-color":"#eee",cursor:"pointer","text-align":"text",padding:"0px","font-size":"2em","background-image":"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAAG0lEQVR42mNgwAfKy8v/48I4FeA0AacVDFQBAP9wJkE/KhUMAAAAAElFTkSuQmCC')","background-repeat":"no-repeat","background-position":"24px 25px"}),r.$button.css(o),e.each(d,function(e,t){r.$button.addClass(t)}),this.$wrapper.append(r.$button);var c=a.pickerSize+2*a.offset,h=a.pickerSize+40+2*a.offset+5;if(r.$dropdown=e("<div><canvas style='display:block;' class='drawrpallete-canvas' width="+h+" height="+c+" style='height:"+c+"px;width:"+h+"px;'></canvas></div>"),r.$dropdown.append('<div style="height:28px;text-align:right;margin-top:-2px;padding:0px 5px;"><button class="cancel">cancel</button><button style="margin-left:5px;width:40px;" class="ok">ok</button></div>'),this.$wrapper.append(r.$dropdown),r.$dropdown.css({background:"#eee",width:h+"px",height:c+28+"px",position:"absolute","z-index":8}),r.$dropdown.find(".ok").css("color","black").on("mouseup.drawrpalette touchend.drawrpalette",function(){a.update_value.call(r),e(r).trigger("choose.drawrpalette",e(r).val()),r.$dropdown.hide(),e(r).trigger("close.drawrpalette")}),r.$dropdown.find(".cancel").css("color","black").on("mouseup.drawrpalette touchend.drawrpalette",function(){a.cancel.call(r),r.$dropdown.hide(),e(r).trigger("close.drawrpalette")}),r.$dropdown.on("mousedown.drawrpalette touchstart.drawrpalette",function(t){var o=a.get_mouse_value(t,r.$dropdown);if(o.x>0&&o.x<a.pickerSize&&o.y>0&&o.y<a.pickerSize){r.slidingHsl=!0;var s=a.xy_to_hsv(o.x,o.y);r.hsv.s=s.s,r.hsv.v=s.v,a.update_color.call(r);var l=a.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=a.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}else if(o.x>a.pickerSize+5&&o.x<a.pickerSize+45&&o.y>0&&o.y<a.pickerSize){r.slidingHue=!0;var n=parseFloat(1/a.pickerSize)*o.y;r.hsv.h=n,a.update_color.call(r);l=a.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=a.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}t.preventDefault(),t.stopPropagation()}),r.$dropdown.hide(),r.$button.on("mousedown.drawrpalette touchstart.drawrpalette",function(t){r.slidingHue=!1,r.slidingHsl=!1,r.$dropdown.show();var o=a.hex_to_rgb(e(r).val()),s=a.rgb_to_hsv(o.r,o.g,o.b);r.hsv=s,a.update_color.call(r),e(r).trigger("open.drawrpalette"),t.preventDefault(),t.stopPropagation()}),e(window).on("mousedown.drawrpalette touchstart.drawrpalette",function(){r.$dropdown.is(":visible")&&(a.cancel.call(r),r.$dropdown.hide(),e(r).trigger("close.drawrpalette"))}),e(window).on("mousemove.drawrpalette touchmove.drawrpalette",function(t){r.$dropdown.find("canvas")[0].getContext("2d");var o=a.get_mouse_value(t,r.$dropdown);if(o.y>a.pickerSize&&(o.y=a.pickerSize),o.y<0&&(o.y=0),o.x<0&&(o.x=0),1==r.slidingHsl){o.x>a.pickerSize&&(o.x=a.pickerSize);var s=a.xy_to_hsv(o.x,o.y);r.hsv.s=s.s,r.hsv.v=s.v,a.update_color.call(r);var l=a.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=a.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}else if(1==r.slidingHue){var n=parseFloat(1/a.pickerSize)*o.y;r.hsv.h=n,a.update_color.call(r);l=a.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=a.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}}),e(window).on("mouseup.drawrpalette touchend.drawrpalette",function(){r.slidingHue=!1,r.slidingHsl=!1}),""!==e(this).val()){var v=a.hex_to_rgb(e(this).val()),u=a.rgb_to_hsv(v.r,v.g,v.b);r.hsv=u,a.update_color.call(r)}else r.hsv={h:0,s:0,v:0},e(this).val("#000000"),a.update_color.call(r)}}),this}}(jQuery);