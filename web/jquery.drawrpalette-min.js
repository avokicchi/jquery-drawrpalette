!function(t){t.fn.drawrpalette=function(e,r){var o=this;return o.offset=5,o.pickerSize=200,o.get_mouse_value=function(t,e){var r={};return"touchmove"==t.type||"touchstart"==t.type?(r.x=t.originalEvent.touches[0].pageX-e.offset().left-o.offset,r.y=t.originalEvent.touches[0].pageY-e.offset().top-o.offset):(r.x=t.pageX-e.offset().left-o.offset,r.y=t.pageY-e.offset().top-o.offset),r},o.rgb_to_hex=function(t,e,r){return"#"+(16777216+(r|e<<8|t<<16)).toString(16).slice(1)},o.hex_to_rgb=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},o.hsv_to_rgb=function(t,e,r){var o,a,s,l,i,n,d,p;switch(1===arguments.length&&(e=t.s,r=t.v,t=t.h),n=r*(1-e),d=r*(1-(i=6*t-(l=Math.floor(6*t)))*e),p=r*(1-(1-i)*e),l%6){case 0:o=r,a=p,s=n;break;case 1:o=d,a=r,s=n;break;case 2:o=n,a=r,s=p;break;case 3:o=n,a=d,s=r;break;case 4:o=p,a=n,s=r;break;case 5:o=r,a=n,s=d}return{r:Math.round(255*o),g:Math.round(255*a),b:Math.round(255*s)}},o.rgb_to_hsv=function(t,e,r){1===arguments.length&&(e=t.g,r=t.b,t=t.r);var o,a=Math.max(t,e,r),s=Math.min(t,e,r),l=a-s,i=0===a?0:l/a,n=a/255;switch(a){case s:o=0;break;case t:o=e-r+l*(e<r?6:0),o/=6*l;break;case e:o=r-t+2*l,o/=6*l;break;case r:o=t-e+4*l,o/=6*l}return{h:o,s:i,v:n}},o.hsv_to_xy=function(t,e,r){return{x:e*o.pickerSize+o.offset,y:(1-r)*o.pickerSize+o.offset}},o.xy_to_hsv=function(t,e){return{s:t/o.pickerSize,v:(o.pickerSize-e)/o.pickerSize}},o.draw_hsv=function(t,e){var r=this.hsv,a=e.getContext("2d");for(a.clearRect(0,0,e.width,e.height),row=0;row<t;row++){var s=a.createLinearGradient(0,0,t,0),l=(t-row)/t,i=o.hsv_to_rgb(r.h,0,l);s.addColorStop(0,"rgb("+i.r+", "+i.g+","+i.b+")");i=o.hsv_to_rgb(r.h,1,l);s.addColorStop(1,"rgb("+i.r+", "+i.g+","+i.b+")"),a.fillStyle=s,a.fillRect(o.offset,row+o.offset,t,1)}for(row=0;row<t;row++)a.fillStyle="hsl("+360/t*row+", 100%, 50%)",a.fillRect(t+o.offset+5,row+o.offset,40,1);a.fillStyle="black",a.fillRect(t+o.offset+3,o.offset+r.h*t-3,44,6),a.fillStyle="white",a.fillRect(t+o.offset+5,o.offset+r.h*t-1,40,2);var n=o.hsv_to_xy(this.hsv.h,this.hsv.s,this.hsv.v);a.beginPath(),a.lineWidth=3,a.strokeStyle="black",a.arc(n.x,n.y,5,0,2*Math.PI),a.stroke(),a.beginPath(),a.lineWidth=2,a.strokeStyle="white",a.arc(n.x,n.y,4,0,2*Math.PI),a.stroke()},o.update_color=function(){var t=this.hsv,e=o.hsv_to_rgb(t.h,t.s,t.v),r="rgb("+e.r+","+e.g+","+e.b+")";this.$button.css("background-color",r),o.draw_hsv.call(this,o.pickerSize,this.$dropdown.find("canvas")[0])},o.update_value=function(){var e=o.hsv_to_rgb(this.hsv.h,this.hsv.s,this.hsv.v),r=o.rgb_to_hex(e.r,e.g,e.b);t(this).val(r)},o.cancel=function(){var e=o.hex_to_rgb(t(this).val()),r=o.rgb_to_hsv(e.r,e.g,e.b);this.hsv=r,o.update_color.call(this),t(this).trigger("cancel.drawrpalette",t(this).val())},this.each(function(){var r=this;if("destroy"===e){if(!t(r).hasClass("active-drawrpalette"))return!1;r.$button.off("mousedown.drawrpalette touchstart.drawrpalette"),r.$dropdown.find(".ok").off("mouseup.drawrpalette touchend.drawrpalette"),r.$dropdown.find(".cancel").off("mouseup.drawrpalette touchend.drawrpalette"),r.$dropdown.off("mousedown.drawrpalette touchstart.drawrpalette"),r.$button.off("mousedown.drawrpalette touchstart.drawrpalette"),t(window).off("mousedown.drawrpalette touchstart.drawrpalette"),t(window).off("mousemove.drawrpalette touchmove.drawrpalette"),t(window).off("mouseup.drawrpalette touchend.drawrpalette"),t(r).show(),r.$button.remove(),r.$dropdown.remove(),t(r).unwrap(),delete r.$wrapper,delete r.$button,delete r.$dropdown,delete r.hsl,delete r.slidingHue,delete r.slidingHsl,t(r).removeClass("active-drawrpalette")}else if("object"==typeof e||void 0===e){for(var a={},s=0,l=r.style.length;s<l;s++){var i=r.style[s],n=getComputedStyle(r,null).getPropertyValue(i);a[i]=n}var d=""!==r.className?r.className.split(" "):[];if(t(r).hasClass("active-drawrpalette"))return!1;r.className=r.className+" active-drawrpalette";var p={enable_alpha:!1,append_to:r};"object"==typeof e&&(p=Object.assign(p,e)),r.settings=p,r.plugin=o,t(this).wrap("<div class='drawrpallete-wrapper'></div>"),this.$wrapper=t(this).parent(),this.$wrapper.css({position:"relative",display:"inline-block"}),t(this).hide(),r.$button=t("<button>&nbsp;</button>"),r.$button.css({width:"40px",height:"40px",border:"2px solid #ccc","background-color":"#eee",cursor:"pointer","text-align":"text",padding:"0px","font-size":"2em","background-image":"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAAG0lEQVR42mNgwAfKy8v/48I4FeA0AacVDFQBAP9wJkE/KhUMAAAAAElFTkSuQmCC')","background-repeat":"no-repeat","background-position":"24px 25px"}),r.$button.css(a),t.each(d,function(t,e){r.$button.addClass(e)}),this.$wrapper.append(r.$button);var h=o.pickerSize+2*o.offset,c=o.pickerSize+40+2*o.offset+5;if(r.$dropdown=t("<div><canvas style='display:block;' class='drawrpallete-canvas' width="+c+" height="+h+" style='height:"+h+"px;width:"+c+"px;'></canvas></div>"),r.$dropdown.append('<div style="height:28px;text-align:right;margin-top:-2px;padding:0px 5px;"><button class="cancel">cancel</button><button style="margin-left:5px;width:40px;" class="ok">ok</button></div>'),this.$wrapper.append(r.$dropdown),r.$dropdown.css({background:"#eee",width:c+"px",height:h+28+"px",position:"absolute","z-index":8}),r.$dropdown.find(".ok").css("color","black").on("mouseup.drawrpalette touchend.drawrpalette",function(){o.update_value.call(r),t(r).trigger("choose.drawrpalette",t(r).val()),r.$dropdown.hide(),t(r).trigger("close.drawrpalette")}),r.$dropdown.find(".cancel").css("color","black").on("mouseup.drawrpalette touchend.drawrpalette",function(){o.cancel.call(r),r.$dropdown.hide(),t(r).trigger("close.drawrpalette")}),r.$dropdown.on("mousedown.drawrpalette touchstart.drawrpalette",function(e){var a=o.get_mouse_value(e,r.$dropdown);if(a.x>0&&a.x<o.pickerSize&&a.y>0&&a.y<o.pickerSize){r.slidingHsl=!0;var s=o.xy_to_hsv(a.x,a.y);r.hsv.s=s.s,r.hsv.v=s.v,o.update_color.call(r);var l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);t(r).trigger("preview.drawrpalette",i)}else if(a.x>o.pickerSize+5&&a.x<o.pickerSize+45&&a.y>0&&a.y<o.pickerSize){r.slidingHue=!0;var n=parseFloat(1/o.pickerSize)*a.y;r.hsv.h=n,o.update_color.call(r);l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);t(r).trigger("preview.drawrpalette",i)}e.preventDefault(),e.stopPropagation()}),r.$dropdown.hide(),r.$button.on("mousedown.drawrpalette touchstart.drawrpalette",function(e){r.slidingHue=!1,r.slidingHsl=!1;var a=r.$button.offset().left+r.$dropdown.outerWidth(),s=t(window).scrollLeft()+t(window).width();r.$dropdown.show(),a<s?r.$dropdown.offset({top:r.$button.offset().top+r.$button.outerHeight(),left:r.$button.offset().left}):r.$dropdown.offset({top:r.$button.offset().top+r.$button.outerHeight(),left:r.$button.offset().left-r.$dropdown.outerWidth()+r.$button.outerWidth()});var l=o.hex_to_rgb(t(r).val()),i=o.rgb_to_hsv(l.r,l.g,l.b);r.hsv=i,o.update_color.call(r),t(r).trigger("open.drawrpalette"),e.preventDefault(),e.stopPropagation()}),t(window).on("mousedown.drawrpalette touchstart.drawrpalette",function(){r.$dropdown.is(":visible")&&(o.cancel.call(r),r.$dropdown.hide(),t(r).trigger("close.drawrpalette"))}),t(window).on("mousemove.drawrpalette touchmove.drawrpalette",function(e){r.$dropdown.find("canvas")[0].getContext("2d");var a=o.get_mouse_value(e,r.$dropdown);if(a.y>o.pickerSize&&(a.y=o.pickerSize),a.y<0&&(a.y=0),a.x<0&&(a.x=0),1==r.slidingHsl){a.x>o.pickerSize&&(a.x=o.pickerSize);var s=o.xy_to_hsv(a.x,a.y);r.hsv.s=s.s,r.hsv.v=s.v,o.update_color.call(r);var l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);t(r).trigger("preview.drawrpalette",i)}else if(1==r.slidingHue){var n=parseFloat(1/o.pickerSize)*a.y;r.hsv.h=n,o.update_color.call(r);l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);t(r).trigger("preview.drawrpalette",i)}}),t(window).on("mouseup.drawrpalette touchend.drawrpalette",function(){r.slidingHue=!1,r.slidingHsl=!1}),""!==t(this).val()){var u=o.hex_to_rgb(t(this).val()),f=o.rgb_to_hsv(u.r,u.g,u.b);r.hsv=f,o.update_color.call(r)}else r.hsv={h:0,s:0,v:0},t(this).val("#000000"),o.update_color.call(r)}}),this}}(jQuery);