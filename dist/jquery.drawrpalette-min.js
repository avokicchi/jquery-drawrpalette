!function(e){e.fn.drawrpalette=function(t,r){var o=this;return o.offset=5,o.pickerSize=200,o.get_mouse_value=function(e,t){var r={};return"touchmove"==e.type||"touchstart"==e.type?(r.x=e.originalEvent.touches[0].pageX-t.offset().left-o.offset,r.y=e.originalEvent.touches[0].pageY-t.offset().top-o.offset):(r.x=e.pageX-t.offset().left-o.offset,r.y=e.pageY-t.offset().top-o.offset),r},o.rgb_to_hex=function(e,t,r){return"#"+(16777216+(r|t<<8|e<<16)).toString(16).slice(1)},o.hex_to_rgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},o.hsv_to_rgb=function(e,t,r){var o,a,s,l,i,n,d,p;switch(1===arguments.length&&(t=e.s,r=e.v,e=e.h),n=r*(1-t),d=r*(1-(i=6*e-(l=Math.floor(6*e)))*t),p=r*(1-(1-i)*t),l%6){case 0:o=r,a=p,s=n;break;case 1:o=d,a=r,s=n;break;case 2:o=n,a=r,s=p;break;case 3:o=n,a=d,s=r;break;case 4:o=p,a=n,s=r;break;case 5:o=r,a=n,s=d}return{r:Math.round(255*o),g:Math.round(255*a),b:Math.round(255*s)}},o.rgb_to_hsv=function(e,t,r){1===arguments.length&&(t=e.g,r=e.b,e=e.r);var o,a=Math.max(e,t,r),s=Math.min(e,t,r),l=a-s,i=0===a?0:l/a,n=a/255;switch(a){case s:o=0;break;case e:o=t-r+l*(t<r?6:0),o/=6*l;break;case t:o=r-e+2*l,o/=6*l;break;case r:o=e-t+4*l,o/=6*l}return{h:o,s:i,v:n}},o.hsv_to_xy=function(e,t,r){return{x:t*o.pickerSize+o.offset,y:(1-r)*o.pickerSize+o.offset}},o.xy_to_hsv=function(e,t){return{s:e/o.pickerSize,v:(o.pickerSize-t)/o.pickerSize}},o.draw_hsv=function(e,t){var r=this.hsv,a=t.getContext("2d");for(a.clearRect(0,0,t.width,t.height),row=0;row<e;row++){var s=a.createLinearGradient(0,0,e,0),l=(e-row)/e,i=o.hsv_to_rgb(r.h,0,l);s.addColorStop(0,"rgb("+i.r+", "+i.g+","+i.b+")");i=o.hsv_to_rgb(r.h,1,l);s.addColorStop(1,"rgb("+i.r+", "+i.g+","+i.b+")"),a.fillStyle=s,a.fillRect(o.offset,row+o.offset,e,1)}for(row=0;row<e;row++)a.fillStyle="hsl("+360/e*row+", 100%, 50%)",a.fillRect(e+o.offset+5,row+o.offset,40,1);a.fillStyle="black",a.fillRect(e+o.offset+3,o.offset+r.h*e-3,44,6),a.fillStyle="white",a.fillRect(e+o.offset+5,o.offset+r.h*e-1,40,2);var n=o.hsv_to_xy(this.hsv.h,this.hsv.s,this.hsv.v);a.beginPath(),a.lineWidth=3,a.strokeStyle="black",a.arc(n.x,n.y,5,0,2*Math.PI),a.stroke(),a.beginPath(),a.lineWidth=2,a.strokeStyle="white",a.arc(n.x,n.y,4,0,2*Math.PI),a.stroke()},o.update_color=function(){var e=this.hsv,t=o.hsv_to_rgb(e.h,e.s,e.v),r="rgb("+t.r+","+t.g+","+t.b+")";this.$button.css("background-color",r),o.draw_hsv.call(this,o.pickerSize,this.$dropdown.find("canvas")[0])},o.update_value=function(){var t=o.hsv_to_rgb(this.hsv.h,this.hsv.s,this.hsv.v),r=o.rgb_to_hex(t.r,t.g,t.b);e(this).val(r)},o.cancel=function(){var t=o.hex_to_rgb(e(this).val()),r=o.rgb_to_hsv(t.r,t.g,t.b);this.hsv=r,o.update_color.call(this),e(this).trigger("cancel.drawrpalette",e(this).val())},this.each(function(){var r=this;if("destroy"===t){if(!e(r).hasClass("active-drawrpalette"))return!1;r.$button.off("mousedown.drawrpalette touchstart.drawrpalette"),r.$dropdown.find(".ok").off("mouseup.drawrpalette touchend.drawrpalette"),r.$dropdown.find(".cancel").off("mouseup.drawrpalette touchend.drawrpalette"),r.$dropdown.off("mousedown.drawrpalette touchstart.drawrpalette"),r.$button.off("mousedown.drawrpalette touchstart.drawrpalette"),e(window).off("mousedown.drawrpalette touchstart.drawrpalette"),e(window).off("mousemove.drawrpalette touchmove.drawrpalette"),e(window).off("mouseup.drawrpalette touchend.drawrpalette"),e(r).show(),r.$button.remove(),r.$dropdown.remove(),e(r).unwrap(),delete r.$wrapper,delete r.$button,delete r.$dropdown,delete r.hsl,delete r.slidingHue,delete r.slidingHsl,e(r).removeClass("active-drawrpalette")}else if("object"==typeof t||void 0===t){for(var a={},s=0,l=r.style.length;s<l;s++){var i=r.style[s],n=getComputedStyle(r,null).getPropertyValue(i);a[i]=n}var d=""!==r.className?r.className.split(" "):[];if(e(r).hasClass("active-drawrpalette"))return!1;r.className=r.className+" active-drawrpalette";var p={enable_alpha:!1,append_to:r};"object"==typeof t&&(p=Object.assign(p,t)),r.settings=p,r.plugin=o,e(this).wrap("<div class='drawrpallete-wrapper'></div>"),this.$wrapper=e(this).parent(),this.$wrapper.css({position:"relative",display:"inline-block"}),e(this).hide(),r.$button=e("<button>&nbsp;</button>"),r.$button.css({width:"40px",height:"40px",border:"2px solid #ccc","background-color":"#eee",cursor:"pointer","text-align":"text",padding:"0px","font-size":"2em","background-image":"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAAG0lEQVR42mNgwAfKy8v/48I4FeA0AacVDFQBAP9wJkE/KhUMAAAAAElFTkSuQmCC')","background-repeat":"no-repeat","background-position":"24px 25px"}),r.$button.css(a),e.each(d,function(e,t){r.$button.addClass(t)}),this.$wrapper.append(r.$button);var c=o.pickerSize+2*o.offset,h=o.pickerSize+40+2*o.offset+5;if(r.$dropdown=e("<div><canvas style='display:block;' class='drawrpallete-canvas' width="+h+" height="+c+" style='height:"+c+"px;width:"+h+"px;'></canvas></div>"),r.$dropdown.append('<div style="height:28px;text-align:right;margin-top:-2px;padding:0px 5px;"><button class="cancel">cancel</button><button style="margin-left:5px;width:40px;" class="ok">ok</button></div>'),this.$wrapper.append(r.$dropdown),r.$dropdown.css({background:"#eee",width:h+"px",height:c+28+"px",position:"absolute","z-index":8}),r.$dropdown.find(".ok").css("color","black").on("mouseup.drawrpalette touchend.drawrpalette",function(){o.update_value.call(r),e(r).trigger("choose.drawrpalette",e(r).val()),r.$dropdown.hide(),e(r).trigger("close.drawrpalette")}),r.$dropdown.find(".cancel").css("color","black").on("mouseup.drawrpalette touchend.drawrpalette",function(){o.cancel.call(r),r.$dropdown.hide(),e(r).trigger("close.drawrpalette")}),r.$dropdown.on("mousedown.drawrpalette touchstart.drawrpalette",function(t){var a=o.get_mouse_value(t,r.$dropdown);if(a.x>0&&a.x<o.pickerSize&&a.y>0&&a.y<o.pickerSize){r.slidingHsl=!0;var s=o.xy_to_hsv(a.x,a.y);r.hsv.s=s.s,r.hsv.v=s.v,o.update_color.call(r);var l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}else if(a.x>o.pickerSize+5&&a.x<o.pickerSize+45&&a.y>0&&a.y<o.pickerSize){r.slidingHue=!0;var n=parseFloat(1/o.pickerSize)*a.y;r.hsv.h=n,o.update_color.call(r);l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}t.preventDefault(),t.stopPropagation()}),r.$dropdown.hide(),r.$button.on("mousedown.drawrpalette touchstart.drawrpalette",function(t){r.slidingHue=!1,r.slidingHsl=!1;var a=r.$button.offset().left,s=a+r.$dropdown.outerWidth(),l=e(window).scrollLeft(),i=l+e(window).width();console.warn("pos check"),console.warn("elementRight",s),console.warn("viewportLeft",l),console.warn("elementLeft",a),console.warn("viewportRight",i),r.$dropdown.show(),s<i?(console.warn("position on the right"),r.$dropdown.offset({top:r.$button.offset().top+r.$button.outerHeight(),left:r.$button.offset().left})):(console.warn("position on the left"),r.$dropdown.offset({top:r.$button.offset().top+r.$button.outerHeight(),left:r.$button.offset().left-r.$dropdown.outerWidth()+r.$button.outerWidth()}));var n=o.hex_to_rgb(e(r).val()),d=o.rgb_to_hsv(n.r,n.g,n.b);r.hsv=d,o.update_color.call(r),e(r).trigger("open.drawrpalette"),t.preventDefault(),t.stopPropagation()}),e(window).on("mousedown.drawrpalette touchstart.drawrpalette",function(){r.$dropdown.is(":visible")&&(o.cancel.call(r),r.$dropdown.hide(),e(r).trigger("close.drawrpalette"))}),e(window).on("mousemove.drawrpalette touchmove.drawrpalette",function(t){r.$dropdown.find("canvas")[0].getContext("2d");var a=o.get_mouse_value(t,r.$dropdown);if(a.y>o.pickerSize&&(a.y=o.pickerSize),a.y<0&&(a.y=0),a.x<0&&(a.x=0),1==r.slidingHsl){a.x>o.pickerSize&&(a.x=o.pickerSize);var s=o.xy_to_hsv(a.x,a.y);r.hsv.s=s.s,r.hsv.v=s.v,o.update_color.call(r);var l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}else if(1==r.slidingHue){var n=parseFloat(1/o.pickerSize)*a.y;r.hsv.h=n,o.update_color.call(r);l=o.hsv_to_rgb.call(r,r.hsv.h,r.hsv.s,r.hsv.v),i=o.rgb_to_hex.call(r,l.r,l.g,l.b);e(r).trigger("preview.drawrpalette",i)}}),e(window).on("mouseup.drawrpalette touchend.drawrpalette",function(){r.slidingHue=!1,r.slidingHsl=!1}),""!==e(this).val()){var u=o.hex_to_rgb(e(this).val()),w=o.rgb_to_hsv(u.r,u.g,u.b);r.hsv=w,o.update_color.call(r)}else r.hsv={h:0,s:0,v:0},e(this).val("#000000"),o.update_color.call(r)}}),this}}(jQuery);